import{d as R,o as _,c as D,F as N,r as it,n as dt,t as k,L as $,s as F,a as ut,b as G,e as B,f as z,g as tt,h as t,u as J,i as K,w as et,j as P,v as I,O as ct,k as q,l as O,m as nt,p as pt,q as ht,x as mt,y as wt,z as st,A as rt,B as lt,C as gt,D as ft,E as vt,G as _t,H as yt}from"./vendor-p7iB914l.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const Dt={class:"fixed_menu"},bt=["onClick"],kt=R({__name:"CheckMenu",props:{menuData:{}},emits:["menuChange"],setup(d,{emit:l}){const e=l,s=n=>{e("menuChange",n.name)};return(n,r)=>(_(),D("div",Dt,[(_(!0),D(N,null,it(n.menuData,(h,w)=>(_(),D("button",{key:w,class:dt({active:h.active}),onClick:b=>s(h)},k(h.label),11,bt))),128))]))}}),H=(d,l)=>{const e=d.__vccOpts||d;for(const[s,n]of l)e[s]=n;return e},xt=H(kt,[["__scopeId","data-v-734811a0"]]);$.init({appId:"lAoggwjRMvY1wU8S39PdpvJX-gzGzoHsz",appKey:"RNOBEZjkuuXGsMvNEYdJOoIK",serverURL:"https://laoggwjr.lc-cn-n1-shared.com"});const Ct=(d,l)=>$.User.logIn(d,l),$t=(d,l)=>{const e=new $.User;return e.setUsername(d),e.setPassword(l),e.signUp()},Mt=()=>$.User.current(),Tt=()=>$.User.logOut(),j=async d=>{if(!$.User.current()){F("请先登录");return}return await d()},W=()=>j(()=>new $.Query("th_Data").find()),St=d=>{const{power:l,type:e,date:s}=d;return j(()=>{const n=new $.Object("th_Data");return n.set("power",l),n.set("type",e),n.set("date",s),n.save()})},Ut=d=>{const{id:l,power:e,type:s,date:n}=d;return j(()=>{const r=$.Object.createWithoutData("th_Data",l);return r.set("power",e),r.set("type",s),r.set("date",n),r.save()})},Pt=d=>j(()=>$.Object.createWithoutData("th_Data",d).destroy()),Lt=async()=>{const d=await W();return j(()=>{$.Object.destroyAll(d)})},Ot=d=>{const l=d.map(e=>{const s=new $.Object("th_Data");return s.set("power",e.power),s.set("type",e.type),s.set("date",e.date),s});return j(()=>$.Object.saveAll(l))},ot=ut("theme",()=>{const[d,l]=window.matchMedia("(prefers-color-scheme: dark)").matches?["dark","light"]:["light","dark"],e=["auto","light","dark"].includes(localStorage.getItem("th_theme")||"")?localStorage.getItem("th_theme"):"auto",s=G({theme:e,autoMode:d,otherMode:l}),n=B(()=>{const b=s.theme==="auto"?s.autoMode:s.otherMode;return document.documentElement.setAttribute("data-theme",b),b}),r=window.matchMedia("(prefers-color-scheme: dark)");function h(b){console.log("系统颜色切换事件"),s.autoMode=b.matches?"dark":"light",s.otherMode=b.matches?"light":"dark"}return r.addEventListener("change",h),{currentTheme:n,toggleTheme:()=>{s.theme=s.theme=="auto"?s.otherMode:"auto",document.documentElement.setAttribute("data-theme",n.value),localStorage.setItem("th_theme",s.theme)}}}),Et={class:"fixed_right"},At={key:0,viewBox:"0 0 24 24",class:"light-icon"},It={key:1,viewBox:"0 0 24 24",class:"dark-icon"},Nt={class:"name"},Bt={class:"wrapper"},zt={class:"inner_box"},jt={class:"title"},Vt={class:"form_item"},Ft={class:"form_item"},Rt={class:"btn_box"},Ht=R({__name:"UserBar",setup(d){const l=ot(),e=()=>{l.toggleTheme()},s=z(!1),n=z(""),r=G({showOverlay:!1,title:"",userName:"",password:""});tt(()=>{h()});const h=()=>{const x=Mt();x&&(s.value=!0,n.value=x.attributes.username)};let w=()=>{};const b=()=>{r.title="登录",r.showOverlay=!0,w=()=>{Ct(r.userName,r.password).then(x=>{O("登录成功"),A(),window.location.reload()}).catch(x=>{F("登录失败")})}},m=()=>{r.title="注册",r.showOverlay=!0,w=()=>{$t(r.userName,r.password).then(x=>{O("注册成功，自动登录"),A(),window.location.reload()}).catch(x=>{F("注册失败，请联系管理员")})}},T=()=>{w()},E=()=>{Object.assign(r,{showOverlay:!1,userName:"",password:""})},A=()=>{E(),h()},V=()=>{q({title:"提示",message:"确定要退出登录吗？",confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>Tt()).then(()=>{s.value=!1,O({message:"退出登录"}),window.location.reload()})};return(x,y)=>(_(),D(N,null,[t("div",Et,[t("div",{class:"theme_btn",onClick:e},[J(l).currentTheme=="dark"?(_(),D("svg",At,y[2]||(y[2]=[t("path",{d:"M6.05 4.14l-.39-.39a.993.993 0 0 0-1.4 0l-.01.01a.984.984 0 0 0 0 1.4l.39.39c.39.39 1.01.39 1.4 0l.01-.01a.984.984 0 0 0 0-1.4zM3.01 10.5H1.99c-.55 0-.99.44-.99.99v.01c0 .55.44.99.99.99H3c.56.01 1-.43 1-.98v-.01c0-.56-.44-1-.99-1zm9-9.95H12c-.56 0-1 .44-1 .99v.96c0 .55.44.99.99.99H12c.56.01 1-.43 1-.98v-.97c0-.55-.44-.99-.99-.99zm7.74 3.21c-.39-.39-1.02-.39-1.41-.01l-.39.39a.984.984 0 0 0 0 1.4l.01.01c.39.39 1.02.39 1.4 0l.39-.39a.984.984 0 0 0 0-1.4zm-1.81 15.1l.39.39a.996.996 0 1 0 1.41-1.41l-.39-.39a.993.993 0 0 0-1.4 0c-.4.4-.4 1.02-.01 1.41zM20 11.49v.01c0 .55.44.99.99.99H22c.55 0 .99-.44.99-.99v-.01c0-.55-.44-.99-.99-.99h-1.01c-.55 0-.99.44-.99.99zM12 5.5c-3.31 0-6 2.69-6 6s2.69 6 6 6s6-2.69 6-6s-2.69-6-6-6zm-.01 16.95H12c.55 0 .99-.44.99-.99v-.96c0-.55-.44-.99-.99-.99h-.01c-.55 0-.99.44-.99.99v.96c0 .55.44.99.99.99zm-7.74-3.21c.39.39 1.02.39 1.41 0l.39-.39a.993.993 0 0 0 0-1.4l-.01-.01a.996.996 0 0 0-1.41 0l-.39.39c-.38.4-.38 1.02.01 1.41z",fill:"currentColor"},null,-1)]))):(_(),D("svg",It,y[3]||(y[3]=[t("path",{d:"M11.01 3.05C6.51 3.54 3 7.36 3 12a9 9 0 0 0 9 9c4.63 0 8.45-3.5 8.95-8c.09-.79-.78-1.42-1.54-.95A5.403 5.403 0 0 1 11.1 7.5c0-1.06.31-2.06.84-2.89c.45-.67-.04-1.63-.93-1.56z",fill:"currentColor"},null,-1)])))]),s.value?(_(),D(N,{key:0},[t("span",Nt,k(n.value),1),t("button",{onClick:V},"退出登录")],64)):(_(),D(N,{key:1},[t("button",{onClick:b},"登录"),t("button",{onClick:m},"注册")],64))]),K(J(ct),{show:r.showOverlay},{default:et(()=>[t("div",Bt,[t("div",zt,[t("div",jt,k(r.title),1),t("div",Vt,[y[4]||(y[4]=t("span",null,"用户",-1)),P(t("input",{type:"text","onUpdate:modelValue":y[0]||(y[0]=L=>r.userName=L),placeholder:"用户名"},null,512),[[I,r.userName]])]),t("div",Ft,[y[5]||(y[5]=t("span",null,"密码",-1)),P(t("input",{type:"password","onUpdate:modelValue":y[1]||(y[1]=L=>r.password=L),placeholder:"请输入密码"},null,512),[[I,r.password]])]),t("div",Rt,[t("button",{onClick:E},"取消"),t("button",{onClick:T},k(r.title),1)])])])]),_:1},8,["show"])],64))}}),Yt=H(Ht,[["__scopeId","data-v-551ce148"]]);function qt(d){const l=document.createElement("input");l.type="file",l.onchange=()=>{var s;const e=(s=l.files)==null?void 0:s[0];if(e){const n=new FileReader;n.onload=r=>{const h=r.target.result;d(h)},n.readAsText(e)}},l.click()}function Jt(d,l){const e=new Blob([l],{type:"text/plain"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download=d,n.click(),URL.revokeObjectURL(s)}const Kt={class:"basic_usage"},Wt={class:"top_box"},Gt={class:"add_box"},Xt={value:"1"},Qt={value:"2"},Zt={class:"list_box"},te={class:"item"},ee={class:"list_content"},oe={class:"opt"},ae=["onClick"],ne=["onClick"],se={class:"wrapper"},re={class:"update_box"},le={class:"form_item"},ie={class:"form_item"},ce={class:"form_item"},de={value:"1"},ue={value:"2"},pe=R({__name:"BasicUsage",setup(d){const l={1:"初号机",2:"贰号机"},e=G({addData:{date:null,power:null,type:"1"},showUpdateDialog:!1,list:[],sort:2,updateData:{}});tt(()=>{s()});const s=()=>{W().then(p=>{e.list=p.map(a=>({id:a.id,...a.attributes}))}).catch(p=>{})},n=B(()=>{const p=e.list.slice().sort((a,o)=>e.sort===1?new Date(a.date).getTime()-new Date(o.date).getTime():new Date(o.date).getTime()-new Date(a.date).getTime());return p.sum=p.reduce((a,o)=>a+o.power,0),p}),r=B(()=>e.sort===1?"升序":"降序"),h=()=>{e.sort=e.sort===1?2:1},w=z(0),b=()=>{w.value+=1,w.value>6&&(w.value=0)},m=B(()=>w.value===6),T=()=>{if(!e.addData.date||!e.addData.power){F("请输入日期或内容");return}St(e.addData).then(()=>{O("添加成功"),s()})},E=p=>{e.updateData={id:p.id,date:p.date,power:p.power,type:p.type},e.showUpdateDialog=!0},A=()=>{e.showUpdateDialog=!1},V=()=>{Ut(e.updateData).then(()=>{O("修改成功"),e.showUpdateDialog=!1,s()})},x=p=>{q({title:"提示",message:"确定删除吗？"}).then(()=>Pt(p.id)).then(()=>{O("删除成功"),s()}).catch(()=>{})},y=()=>{qt(a=>{try{const o=JSON.parse(a);p(o)}catch{F("文件解析失败")}});function p(a){q({title:"确认导入",message:`共 ${a.length} 条数据，
将删除原有所有数据，
写入新的数据

是否导入？`}).then(()=>Lt()).then(()=>Ot(a)).then(()=>{O("导入成功"),s()})}},L=()=>{console.log("导出"),W().then(async p=>{try{await q({title:"确认导出",message:`共${p.length}条数据，
是否确认导出？`});const a=p.map(C=>({...C.attributes})),c=`th-summary-data-${pt().format("YYYYMMDDHHmmss")}.json`,v=JSON.stringify(a);Jt(c,v),ht({title:"提示",message:"数据导出成功"})}catch{}})};return(p,a)=>(_(),D("div",Kt,[a[18]||(a[18]=t("h2",{class:"title"},"TH 汎用ヒト型決戦兵器",-1)),t("div",Wt,[t("button",{onClick:y},"导入数据"),t("button",{onClick:L},"导出数据"),t("button",{class:"right",onClick:h},k(r.value),1)]),t("div",Gt,[a[7]||(a[7]=t("span",null,"日期",-1)),P(t("input",{class:"input",type:"date","onUpdate:modelValue":a[0]||(a[0]=o=>e.addData.date=o)},null,512),[[I,e.addData.date]]),a[8]||(a[8]=t("span",null,"战力",-1)),P(t("input",{class:"input",type:"number",placeholder:"请输入内容","onUpdate:modelValue":a[1]||(a[1]=o=>e.addData.power=o)},null,512),[[I,e.addData.power]]),a[9]||(a[9]=t("span",null,"类型",-1)),P(t("select",{class:"input select","onUpdate:modelValue":a[2]||(a[2]=o=>e.addData.type=o)},[t("option",Xt,k(l[1]),1),t("option",Qt,k(l[2]),1)],512),[[nt,e.addData.type]]),t("button",{onClick:a[3]||(a[3]=o=>T())},"添加")]),t("div",Zt,[t("div",te,[a[10]||(a[10]=t("span",null,"序号",-1)),a[11]||(a[11]=t("span",null,"日期",-1)),a[12]||(a[12]=t("span",null,"战力",-1)),a[13]||(a[13]=t("span",null,"类型",-1)),t("span",{class:"opt",onClick:b},k(m.value?n.value.sum:"操作"),1)]),t("div",ee,[(_(!0),D(N,null,it(n.value,(o,c)=>(_(),D("div",{class:"item",key:c},[t("span",null,k(c+1||o.id),1),t("span",null,k(o.date),1),t("span",null,k(o.power),1),t("span",null,k(l[o.type]),1),t("span",oe,[t("button",{onClick:v=>E(o)},"修改",8,ae),t("button",{onClick:v=>x(o)},"删除",8,ne)])]))),128))])]),K(J(ct),{show:e.showUpdateDialog},{default:et(()=>[t("div",se,[t("div",re,[a[17]||(a[17]=t("div",{class:"title_text"},[t("span",null,"修改")],-1)),t("div",le,[a[14]||(a[14]=t("span",null,"日期",-1)),P(t("input",{class:"input",type:"date","onUpdate:modelValue":a[4]||(a[4]=o=>e.updateData.date=o)},null,512),[[I,e.updateData.date]])]),t("div",ie,[a[15]||(a[15]=t("span",null,"战力",-1)),P(t("input",{class:"input",type:"number",placeholder:"请输入内容","onUpdate:modelValue":a[5]||(a[5]=o=>e.updateData.power=o)},null,512),[[I,e.updateData.power]])]),t("div",ce,[a[16]||(a[16]=t("span",null,"类型",-1)),P(t("select",{class:"input select","onUpdate:modelValue":a[6]||(a[6]=o=>e.updateData.type=o)},[t("option",de,k(l[1]),1),t("option",ue,k(l[2]),1)],512),[[nt,e.updateData.type]])]),t("div",{class:"btn_box"},[t("button",{onClick:A},"取消"),t("button",{onClick:V},"保存")])])])]),_:1},8,["show"])]))}}),he=H(pe,[["__scopeId","data-v-9d278e0d"]]),me={class:"data_visual"},we={key:0},ge={class:"btn_box"},fe={class:"b1"},ve={class:"b2"},_e=R({__name:"DataVisual",setup(d){const l=ot(),e=B(()=>l.currentTheme==="dark"?"#fff":"#333"),s=z("");mt(()=>l.currentTheme,()=>{s.value&&T(s.value)});const n=z([]),r=async()=>{const o=await W();if(o.length===0)throw new Error("暂无数据");n.value=o.map(c=>({id:c.id,...c.attributes})).sort((c,v)=>new Date(c.date).getTime()-new Date(v.date).getTime())};let h=null,w=null;const b=B(()=>n.value.length==0);tt(()=>{r().then(()=>{h=document.getElementById("main"),w=wt(h),T("all_month")}).catch(o=>{})});const m=G({show:!1,year:new Date().getFullYear(),month:new Date().getMonth()+1}),T=o=>{switch(s.value=o,o){case"all":m.show=!1,p(void 0);break;case"all_month":m.show=!1,L();break;case"this_month":E();break}},E=()=>{m.month=new Date().getMonth()+1,m.year=new Date().getFullYear(),m.show=!0,x()},A=()=>{m.month>1?m.month--:(m.month=12,m.year--),x()},V=()=>{m.month<12?m.month++:(m.month=1,m.year++),x()},x=()=>{const{year:o,month:c}=m;p({year:o,month:c})},y=(o=[],c=[],v=[],C="平均能耗")=>{w.clear();let M={title:{text:C,subtext:"单位：KWh",right:"0",textStyle:{color:e.value}},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{color:"#ffffff"},crossStyle:{color:e.value}},formatter:function(u){let g=0;return u.forEach(U=>{g+=U.value}),u[0].name+"<br/>"+u[0].marker+u[0].seriesName+" : "+u[0].value+"<br/>"+u[1].marker+u[1].seriesName+" : "+u[1].value+"<br/>合计 : "+g}},legend:{data:["初号机","贰号机"],textStyle:{color:e.value},left:0},grid:{left:"0%",right:"3%",bottom:"45",top:"72",containLabel:!0},xAxis:[{type:"category",data:o,axisPointer:{type:"shadow"},axisLabel:{show:!0,color:e.value}}],yAxis:[{type:"value",nameTextStyle:{color:"#ffffff"},min:0,axisLabel:{color:e.value},splitLine:{show:!0,lineStyle:{type:"dotted"}}}],series:[{name:"初号机",type:"bar",stack:"th",data:c,itemStyle:{color:"#5472c6"},label:{show:!1,formatter:function(u){return u.value!==0?u.value:""}}},{name:"贰号机",type:"bar",stack:"th",data:v,itemStyle:{color:"#d36531"},label:{show:!0,position:"top",color:e.value,formatter:function(u){let g=c[u.dataIndex],U=v[u.dataIndex];return g+U||""}}}],dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100,handleSize:"80%",handleStyle:{color:"#d3dee5",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}]};w.setOption(M),window.addEventListener("resize",()=>{w.resize()})},L=()=>{const o=n.value,c=i=>{const[f,S]=i.split("-");return new Date(f,S-1)},v=c(o[0].date),C=c(o[o.length-1].date),M=[];let u=new Date(v);for(;u<=C;){const i=u.getFullYear(),f=String(u.getMonth()+1).padStart(2,"0");M.push(`${i}-${f}`),u.setMonth(u.getMonth()+1)}const g=new Map;o.forEach(i=>{const[f,S]=i.date.split("-"),Q=`${f}-${S}`,Z=g.get(Q)||{month:Q,totalPower1:0,totalPower2:0};i.type=="1"?Z.totalPower1+=i.power:Z.totalPower2+=i.power,g.set(Q,Z)}),M.forEach(i=>{g.has(i)||g.set(i,{month:i,totalPower1:0,totalPower2:0})});const U=M.map(i=>g.get(i).totalPower1),Y=M.map(i=>g.get(i).totalPower2),X=a([...g.values()].map(i=>i.totalPower1+i.totalPower2));y(M,U,Y,`月均能耗 ：${X}`)},p=o=>{const c=n.value;let v="总和能耗",C=new Date(c[0].date),M=new Date(c[c.length-1].date);o&&(v=o.year+"年"+o.month+"月能耗",C=new Date(o.year,o.month-1,1),M=new Date(o.year,o.month,0));const u=[];for(;C<=M;){const i=C.getFullYear(),f=String(C.getMonth()+1).padStart(2,"0"),S=String(C.getDate()).padStart(2,"0");u.push(`${i}-${f}-${S}`),C.setDate(C.getDate()+1)}const g=new Map;c.forEach(i=>{const f=i.date,S=g.get(f)||{date:f,totalPower1:0,totalPower2:0};i.type=="1"?S.totalPower1+=i.power:S.totalPower2+=i.power,g.set(f,S)}),u.forEach(i=>{g.has(i)||g.set(i,{date:i,totalPower1:0,totalPower2:0})});const U=u.map(i=>g.get(i).totalPower1),Y=u.map(i=>g.get(i).totalPower2),X=U.reduce((i,f)=>i+f)+Y.reduce((i,f)=>i+f);y(u,U,Y,`${v} ：${X}`)};function a(o){return(o.reduce((c,v)=>c+v,0)/o.length).toFixed(2)}return(o,c)=>(_(),D("div",me,[c[4]||(c[4]=t("h2",{class:"title"},"数据展示",-1)),b.value?(_(),D("span",we,"暂无数据")):(_(),D(N,{key:1},[c[3]||(c[3]=t("div",{id:"main"},null,-1)),t("div",ge,[t("div",fe,[t("button",{onClick:c[0]||(c[0]=v=>T("all"))},"全部"),t("button",{onClick:c[1]||(c[1]=v=>T("all_month"))},"按月总览")]),t("div",ve,[m.show?(_(),D("button",{key:0,onClick:A},"上个月")):st("",!0),t("button",{onClick:c[2]||(c[2]=v=>T("this_month"))},"本月"),m.show?(_(),D("button",{key:1,onClick:V},"下个月")):st("",!0)])])],64))]))}}),ye=H(_e,[["__scopeId","data-v-4286766f"]]),De={class:"head"},be={class:"content"},ke=R({__name:"App",setup(d){const l=ot(),e=z([{name:"BasicUsage",label:"基础数据",component:rt(he),active:!0},{name:"DataVisual",label:"数据可视化",component:rt(ye),active:!1}]),s=n=>{e.value.forEach(r=>{r.active=r.name===n})};return(n,r)=>{const h=gt("van-config-provider");return _(),lt(h,{theme:J(l).currentTheme},{default:et(()=>{var w;return[t("header",De,[K(xt,{menuData:e.value,onMenuChange:s},null,8,["menuData"]),K(Yt)]),t("div",be,[(_(),lt(ft((w=e.value.find(b=>b.active))==null?void 0:w.component)))])]}),_:1},8,["theme"])}}}),xe=H(ke,[["__scopeId","data-v-1bfab150"]]),Ce=vt(),at=_t(xe);at.use(yt);at.use(Ce);at.mount("#app");
